<!DOCTYPE html>
<html lang="en">

<head>
  <title>if.then()</title>
  <link rel="icon" type="image/x-icon" href="./Resources/if-high-resolution-logo.png" />
  <meta name="author" content="Biku Das" />
  <meta name="description" content="5.1P" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta charset="utf-8" />
  <!--BootStrap-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <!--ICONs Bootstrap-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="./indexStyle.css" />
  <script src="./navAndFooter.js"></script>
</head>

<body class="d-flex flex-column min-vh-100">
  <div id="navbar-placeholder" class="sticky-top"></div>
  <!--Navbar-->

  <main class="container">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6 p-4 rounded shadow-lg my-5 bg-light">
        <div id="scenario-container"> </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>
  <!--Footer-->
  <script src="./vote.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");
      const scenario = scenarios.find((s) => s.id === id);
      const scenarioContainer = document.getElementById('scenario-container');
      scenarioContainer.innerHTML = '';

      if (scenario) {
        let tagsHTML = '';
        for (let i = 0; i < scenario.tags.length; i++) {
          const tag = scenario.tags[i];
          const bgColor = tagStyles[tag] || '#bdc3c7';
          tagsHTML += `<span class="badge me-2" style="background-color: ${bgColor}; color: white;">${tag}</span>`;
        }


        const card = document.createElement('div');
        card.innerHTML = `
            <h2 id="scenario-title">${scenario.title}</h2>
            <img src="${scenario.imageUrl}" id="scenario-image" class="img-fluid mb-3 rounded" alt="${scenario.title}"
            style="width: 100; object-fit: cover" />
          <p id="scenario-description">${scenario.description}</p>

          <div class="d-flex align-items-center">
            <button class="btn border-success btn-md me-2 flex-fill upvote-btn">
              <i class="bi bi-hand-thumbs-up"></i> <span class="upvote-count">${scenario.upvotes}</span>
            </button>
            <button class="btn border-danger btn-md flex-fill downvote-btn">
              <i class="bi bi-hand-thumbs-down"></i> <span class="downvote-count">${scenario.downvotes || 0}</span>
            </button>
          </div>


          <h4 class="mt-4">Comments</h4>
          <ul id="comments-list" class="list-group mb-4"></ul>

          <form id="comment-form" onsubmit="return handleCommentPost();">
            <div class="mb-3">
              <textarea id="comment-input" class="form-control" placeholder="Write a comment..." required></textarea>
            </div>
            <button type="submit" class="btn btn-primary" id="submit-btn">
              Post Comment
            </button>
          </form>
          `;
        scenarioContainer.appendChild(card);
        setUpVotes(card, scenario);

        const commentsList = document.getElementById("comments-list");
        scenario.comments.forEach((comment) => {
          const li = document.createElement("li");
          li.className = "list-group-item mb-3";

          li.innerHTML = 
                `<div>
                  <h6 class="mb-1 text-muted">
                    <strong>${comment.author}</strong> · 
                    <small>${new Date(
            comment.timestamp
          ).toLocaleString()}</small>
                  </h6>
                  <p class="card-text">${comment.comment}</p>
                </div>`
            ;
          commentsList.appendChild(li);
        });
      } else {
        document.body.innerHTML =
          "<div class='container mt-5'><h2>Scenario not found.</h2></div>";
      }
    });

    function handleCommentPost() {
      const commentInput = document.getElementById("comment-input");
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");
      const scenario = scenarios.find((s) => s.id === id);
      const newComment = {
        author: "New Author",
        timestamp: new Date().toISOString(),
        comment: commentInput.value,
      };
      scenario.comments.push(newComment);

      const li = document.createElement("li");
      li.className = "list-group-item mb-3";
      li.innerHTML = `
          <div>
            <h6 class="mb-1 text-muted">
              <strong>${newComment.author}</strong> · 
              <small>${new Date(newComment.timestamp).toLocaleString()}</small>
            </h6>
            <p class="card-text">${newComment.comment}</p>
          </div>
          `;
      document.getElementById("comments-list").appendChild(li);
      commentInput.value = "";
      return false; //prevent relod to show comment
    }
  </script>
</body>

</html>