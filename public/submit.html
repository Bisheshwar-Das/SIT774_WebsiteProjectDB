<!DOCTYPE html>
<html>

<head>
  <title>if.then()</title>
  <link rel="icon" type="image/x-icon" href="./Resources/if-high-resolution-logo.png" />
  <meta name="author" content="Biku Das" />
  <meta name="description" content="5.1P" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta charset="utf-8" />
  <!-- BootStrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <!-- ICONs Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="./indexStyle.css" />

  <!-- Styles and Scripts for  select 2 bootstrap-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.slim.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script src="./navAndFooter.js"></script>
</head>

<body class="d-flex flex-column min-vh-100">
  <div id="navbar-placeholder" class="sticky-top"></div>

  <section class="py-5 flex-grow-1">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-8 p-4 shadow rounded bg-light" >

          <h2 class="text-center mb-4">Submit Your WhatIF</h2>
          <form class="needs-validation" action="/submit" method="post" enctype="multipart/form-data" novalidate>
            <div class="form-group">
              <label for="scenarioTitle">Scenario Title</label>
              <input type="text" class="form-control" id="scenarioTitle" name="scenarioTitle" placeholder="What is your scenario?" required />
              <div class="invalid-feedback">Please add your whatif.</div>
            </div>
            <div class="form-group">
              <label for="scenarioDescription">Scenario Description</label>
              <textarea class="form-control" id="scenarioDescription" name="scenarioDescription" rows="4"
              placeholder="Describe your scenario in detail" required></textarea>
              <div class="invalid-feedback">Please add your description</div>
            </div>
            
            <div class="form-group">
              <label for="scenarioTags">Tags</label>
              <select class="form-select" id="multiple-select-custom-field" name="multiple-select-custom-field[]" data-placeholder="Choose existing or add new" multiple
              required></select>
              <div class="invalid-feedback">Please add at least one tag.</div>
            </div>
            
            <div class="my-2">
              <label for="scenarioImage" class="form-label">Optional Image</label>
              <input class="form-control" type="file" id="scenarioImage" name="scenarioImage" accept="image/*" />
            </div>
            <button type="submit" class="btn btn-primary mt-3">
              Submit WhatIf
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <div id="footer-placeholder"></div>

  <script src="./scenarios.js"></script>
  <!-- Ensure this is loaded before the form script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    // boostrap form validation
    (function () {
      "use strict";
      const forms = document.querySelectorAll(".needs-validation");
      Array.from(forms).forEach(function (form) {
        form.addEventListener(
          "submit",
          function (event) {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add("was-validated");
          },
          false
        );
      });
    })();

    document.addEventListener("DOMContentLoaded", () => {
      const tagSelect = document.getElementById("multiple-select-custom-field");
      const tagSet = Object.keys(tagStyles); // Use keys from tagStyles for the tags

      // Populate the select options with multiple tags
      tagSet.forEach((tag) => {
        const option = document.createElement("option");
        option.value = tag;
        option.textContent = tag;
        tagSelect.appendChild(option);
      });


        // select 2 bootstrap reference: https://apalfrey.github.io/select2-bootstrap-5-theme/examples/multiple-select/
        $("#multiple-select-custom-field").select2({
          theme: "bootstrap-5",
          width: $(this).data("width")
            ? $(this).data("width")
            : $(this).hasClass("w-100")
              ? "100%"
              : "style",
          placeholder: $(this).data("Choose existing or add new"),
          closeOnSelect: true,
          tags: true,
        });
        
        const form = document.querySelector("form");
        form.addEventListener("submit", function (event) {
          /* event.preventDefault();  // Prevent default form submission */
          
          const title = document.getElementById("scenarioTitle").value;
          const description = document.getElementById("scenarioDescription").value;
          const selectedTags = $(tagSelect).val();  // Get selected tags from Select2
          const image = document.getElementById("scenarioImage").files[0];  // Get uploaded image file
          
          // Validate form inputs
          if (!title || !description || selectedTags.length === 0) {
            return;
          }
          
          /* Log the form data to the console
          console.log("Form Submitted");
          console.log("Title: " + title);
          console.log("Description: " + description);
          console.log("Selected Tags: " + selectedTags);
          console.log("Image: ", image ? image.name : "No image uploaded");
          
          // Show a success message
          alert("Your 'What If' scenario has been submitted successfully!") 
          
          // Optionally reset the form after submission
          form.reset();
          $(tagSelect).val(null).trigger("change");  // Reset the Select2 field */
        });
        
      });

  </script>
</body>

</html>